from Vulnerabilities.WeakPassword import *
from Vulnerabilities.PortScanner import *
from TypeGetter import *
from Vulnerabilities.SMTPUserEnumeration import *
from Vulnerabilities.PANConflict import *
from Vulnerabilities.OpenKeyTransfer import *
from Vulnerabilities.NoPass import *
from Vulnerabilities.MQTTPubSub import *
from Vulnerabilities.LinkKey import *
class VulnerabilityChecker:

    def __init__(self):
        """
        Инициализация объекта.
        """
        self.name = ''
        self.desc = ''
        self.threats = ''
        self.methods = ''

    def check(self, devices):
        port_checker = PortScanner()
        print(port_checker.check(devices))
        checker_weak_password = WeakPassword()
        for i in devices:
            i['type'] = next((k for k, v in device_str_name.items() if v == i['тип']), None)
        print('weak password check')
        weak_password_devices = checker_weak_password.check(devices)
        print('weak', weak_password_devices)
        smtp_enum = SMTPUserEnumeration()
        smtp_devices = smtp_enum.check(devices)
        print('smtp', smtp_devices)
        kb = KillerBee()
        kb.start_sniffing()
        time.sleep(5)  # Слушаем 5 секунд для захвата пакетов
        packets = kb.get_packets()
        pan_conf_checker = PANConflict()
        pan_devices = pan_conf_checker.check(devices, packets)
        print('pan', pan_devices)
        open_key = OpenKeyTransfer()
        open_key_devices = open_key.check(devices, packets)
        print('open key', open_key_devices)
        linkey = LinkKey()
        linkey_devices = linkey.check(devices, packets)
        print('linkey', linkey_devices)
        nopass = NoPass()
        no_pass_devices = nopass.check(devices)
        print('no pass', no_pass_devices)
        mqtt_pub_sub = MQTTPubSub()
        mqtt_devices = mqtt_pub_sub.check(devices)
        print('mqtt_pub_sub', mqtt_devices)
